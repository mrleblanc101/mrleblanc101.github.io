{"_path":"/blog/2023-01-17-momentjs-avec-nuxt3","_dir":"blog","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Utiliser moment.js avec Nuxt 3","description":"Vous avez peut-être remarquer que le module @nuxtjs/moment n'est pas capatible avec Nuxt 3.","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vous avez peut-être remarquer que le module "},{"type":"element","tag":"a","props":{"href":"https://github.com/nuxt-community/moment-module","rel":["nofollow"]},"children":[{"type":"text","value":"@nuxtjs/moment"}]},{"type":"text","value":" n'est pas capatible avec Nuxt 3."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vous vous demandez sans doute pourquoi as-t-on besoin d'un module pour utiliser "},{"type":"element","tag":"a","props":{"href":"https://momentjs.com/","rel":["nofollow"]},"children":[{"type":"text","value":"moment.js"}]},{"type":"text","value":" dans Nuxt ?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Dans Nuxt 2, lorsque vous utilisez "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"moment.js"}]},{"type":"text","value":", Webpack importe toutes les locales par défaut. Cela équivaut à plus d'une centaine de locales qui sont importées alors que vous n'avez probablement besoin que d'une ou deux d'entre elles."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Voilà ou entre en jeu "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"@nuxtjs/moment"}]},{"type":"text","value":"; celui-ci se charge de supprimer les locales inutiles en utilisant "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"moment-locales-webpack-plugin"}]},{"type":"text","value":" afin de réduire la taille du bundle de votre application."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Si vous avez suivi l'actualité, vous savez peut-être que Nuxt 3 utilise maintenant "},{"type":"element","tag":"a","props":{"href":"https://vitejs.dev/","rel":["nofollow"]},"children":[{"type":"text","value":"Vite.js"}]},{"type":"text","value":" au lieu de Webpack afin de bundler votre application. Il n'est donc plus nécessaire de suppimer les locales inutilisées du bundle puisque Vite.js s'en charge déjà grâce à son meilleur support du tree-shaking."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Voici comment créer votre propre plugin pour utiliser moment.js directement dans une application multilingue utilisant "},{"type":"element","tag":"a","props":{"href":"https://v8.i18n.nuxtjs.org/","rel":["nofollow"]},"children":[{"type":"text","value":"@nuxtjs/i18n"}]},{"type":"text","value":" et TypeScript dans Nuxt 3."}]},{"type":"element","tag":"code","props":{"code":"import moment from 'moment';\nimport 'moment/locale/fr-ca';\nimport type { NuxtApp } from '#app';\n\nexport default defineNuxtPlugin((nuxtApp) => {\n    const locale = nuxtApp.$i18n.locale.value;\n    moment.locale(locale);\n\n    nuxtApp.$i18n.onBeforeLanguageSwitch = (\n        oldLocale: string,\n        newLocale: string,\n        isInitialSetup: boolean,\n        nuxtApp: NuxtApp\n    ) => {\n        moment.locale(newLocale);\n    };\n\n    return {\n        provide: {\n            moment,\n        },\n    };\n});\n","filename":"plugins/moment.ts","highlights":[2],"language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"import moment from 'moment';\nimport 'moment/locale/fr-ca';\nimport type { NuxtApp } from '#app';\n\nexport default defineNuxtPlugin((nuxtApp) => {\n    const locale = nuxtApp.$i18n.locale.value;\n    moment.locale(locale);\n\n    nuxtApp.$i18n.onBeforeLanguageSwitch = (\n        oldLocale: string,\n        newLocale: string,\n        isInitialSetup: boolean,\n        nuxtApp: NuxtApp\n    ) => {\n        moment.locale(newLocale);\n    };\n\n    return {\n        provide: {\n            moment,\n        },\n    };\n});\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"À première vue, ce code d'importation (ligne 1 et 2) qui provient de la documentation officiel de moment.js devrait fonctionner.\nPar contre, si vous avez utiliser ce code directement, vous aurez remarquer cette erreur lors de la compilation:"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Uncaught TypeError: Cannot read properties of undefined (reading 'defineLocale')"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Il s'agit d'une erreur déroutante que je pris bien du temps à corriger, mais grâce à cette "},{"type":"element","tag":"a","props":{"href":"https://github.com/moment/moment/issues/5926#issuecomment-1056785251","rel":["nofollow"]},"children":[{"type":"text","value":"issue"}]},{"type":"text","value":" Github, j'ai finalement réussi à réglé le problème et complété la migration vers Nuxt 3 de mon application."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Avec Vite.js, il faut simplement changer l'import des locales comme ceci:"}]},{"type":"element","tag":"code","props":{"code":"- import 'moment/locale/fr-ca';\n\n+ import 'moment/dist/locale/fr-ca';\n","language":"diff"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"- import 'moment/locale/fr-ca';\n\n+ import 'moment/dist/locale/fr-ca';\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Malheureusement, ne vous attendez pas à une correction de la part de moment.js puisque le projet est en mode maintenance et ne recevera de mise à jour que si une faille de sécurité majeure est découverte."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vous pouvez migrer vers une alternatives plus modernes à moment.js, mais dans mon cas, je devais migré une code base utilisant largement moment.js en Nuxt 3."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"J'ai bien tenté de migrer vers "},{"type":"element","tag":"a","props":{"href":"https://day.js.org/","rel":["nofollow"]},"children":[{"type":"text","value":"Day.js"}]},{"type":"text","value":" a une API rétrocompatible et à l'avantage d'une approche modulaire et un code plus moderne lui permettant d'avoir un poid réduit (7kb vs 61kb) en prenant avantage des dernières fonctionnalités d'internationalisation d'EcmaScript, mais j'ai fait façe à une fonctionalité manquante en lien avec le parsing des heures (Ex. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"10:00:00"}]},{"type":"text","value":") sans date d'associées."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Heureusement, je pourrai peut-être faire la migration éventuellement puisqu'une "},{"type":"element","tag":"a","props":{"href":"https://github.com/iamkun/dayjs/pull/2197","rel":["nofollow"]},"children":[{"type":"text","value":"pull request"}]},{"type":"text","value":" afin d'apporter cette fonctionnalité à Day.js a été ouverte après que j'aie ouvert l'"},{"type":"element","tag":"a","props":{"href":"https://github.com/iamkun/dayjs/issues/2179","rel":["nofollow"]},"children":[{"type":"text","value":"issue"}]},{"type":"text","value":" sur Github afin de reportée ce manquemant par rapport à moment.js."}]}]},"createdAt":"2023-01-17T00:00:00.000Z","readingTime":{"text":"3 min read","minutes":2.25,"time":135000,"words":450},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vous avez peut-être remarquer que le module "},{"type":"element","tag":"a","props":{"href":"https://github.com/nuxt-community/moment-module","rel":["nofollow"]},"children":[{"type":"text","value":"@nuxtjs/moment"}]},{"type":"text","value":" n'est pas capatible avec Nuxt 3."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vous vous demandez sans doute pourquoi as-t-on besoin d'un module pour utiliser "},{"type":"element","tag":"a","props":{"href":"https://momentjs.com/","rel":["nofollow"]},"children":[{"type":"text","value":"moment.js"}]},{"type":"text","value":" dans Nuxt ?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Dans Nuxt 2, lorsque vous utilisez "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"moment.js"}]},{"type":"text","value":", Webpack importe toutes les locales par défaut. Cela équivaut à plus d'une centaine de locales qui sont importées alors que vous n'avez probablement besoin que d'une ou deux d'entre elles."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Voilà ou entre en jeu "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"@nuxtjs/moment"}]},{"type":"text","value":"; celui-ci se charge de supprimer les locales inutiles en utilisant "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"moment-locales-webpack-plugin"}]},{"type":"text","value":" afin de réduire la taille du bundle de votre application."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Si vous avez suivi l'actualité, vous savez peut-être que Nuxt 3 utilise maintenant "},{"type":"element","tag":"a","props":{"href":"https://vitejs.dev/","rel":["nofollow"]},"children":[{"type":"text","value":"Vite.js"}]},{"type":"text","value":" au lieu de Webpack afin de bundler votre application. Il n'est donc plus nécessaire de suppimer les locales inutilisées du bundle puisque Vite.js s'en charge déjà grâce à son meilleur support du tree-shaking."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Voici comment créer votre propre plugin pour utiliser moment.js directement dans une application multilingue utilisant "},{"type":"element","tag":"a","props":{"href":"https://v8.i18n.nuxtjs.org/","rel":["nofollow"]},"children":[{"type":"text","value":"@nuxtjs/i18n"}]},{"type":"text","value":" et TypeScript dans Nuxt 3."}]},{"type":"element","tag":"code","props":{"code":"import moment from 'moment';\nimport 'moment/locale/fr-ca';\nimport type { NuxtApp } from '#app';\n\nexport default defineNuxtPlugin((nuxtApp) => {\n    const locale = nuxtApp.$i18n.locale.value;\n    moment.locale(locale);\n\n    nuxtApp.$i18n.onBeforeLanguageSwitch = (\n        oldLocale: string,\n        newLocale: string,\n        isInitialSetup: boolean,\n        nuxtApp: NuxtApp\n    ) => {\n        moment.locale(newLocale);\n    };\n\n    return {\n        provide: {\n            moment,\n        },\n    };\n});\n","filename":"plugins/moment.ts","highlights":[2],"language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-9c4aea"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-82aea0"},"children":[{"type":"text","value":"moment"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9c4aea"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9ae664"},"children":[{"type":"text","value":"'moment'"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line highlight"},"children":[{"type":"element","tag":"span","props":{"class":"ct-9c4aea"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9ae664"},"children":[{"type":"text","value":"'moment/locale/fr-ca'"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-9c4aea"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9c4aea"},"children":[{"type":"text","value":"type"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-82aea0"},"children":[{"type":"text","value":"NuxtApp"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"class":"ct-9c4aea"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9ae664"},"children":[{"type":"text","value":"'#app'"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-9c4aea"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9c4aea"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-82aea0"},"children":[{"type":"text","value":"defineNuxtPlugin"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"((nuxtApp) "}]},{"type":"element","tag":"span","props":{"class":"ct-083dc6"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-083dc6"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-82aea0"},"children":[{"type":"text","value":"locale"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9c4aea"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-82aea0"},"children":[{"type":"text","value":"nuxtApp"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-82aea0"},"children":[{"type":"text","value":"$i18n"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-82aea0"},"children":[{"type":"text","value":"locale"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-82aea0"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-82aea0"},"children":[{"type":"text","value":"moment"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-82aea0"},"children":[{"type":"text","value":"locale"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-82aea0"},"children":[{"type":"text","value":"locale"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-82aea0"},"children":[{"type":"text","value":"nuxtApp"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-82aea0"},"children":[{"type":"text","value":"$i18n"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-82aea0"},"children":[{"type":"text","value":"onBeforeLanguageSwitch"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9c4aea"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" ("}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"        oldLocale"}]},{"type":"element","tag":"span","props":{"class":"ct-9c4aea"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9c4aea"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"        newLocale"}]},{"type":"element","tag":"span","props":{"class":"ct-9c4aea"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9c4aea"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"        isInitialSetup"}]},{"type":"element","tag":"span","props":{"class":"ct-9c4aea"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-9c4aea"},"children":[{"type":"text","value":"boolean"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"        nuxtApp"}]},{"type":"element","tag":"span","props":{"class":"ct-9c4aea"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ad8eda"},"children":[{"type":"text","value":"NuxtApp"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"    ) "}]},{"type":"element","tag":"span","props":{"class":"ct-083dc6"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-82aea0"},"children":[{"type":"text","value":"moment"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-82aea0"},"children":[{"type":"text","value":"locale"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-82aea0"},"children":[{"type":"text","value":"newLocale"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"    };"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-9c4aea"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":" {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"        provide: {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-82aea0"},"children":[{"type":"text","value":"moment"}]},{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"        },"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"    };"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-29651d"},"children":[{"type":"text","value":"});"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"À première vue, ce code d'importation (ligne 1 et 2) qui provient de la documentation officiel de moment.js devrait fonctionner.\nPar contre, si vous avez utiliser ce code directement, vous aurez remarquer cette erreur lors de la compilation:"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Uncaught TypeError: Cannot read properties of undefined (reading 'defineLocale')"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Il s'agit d'une erreur déroutante que je pris bien du temps à corriger, mais grâce à cette "},{"type":"element","tag":"a","props":{"href":"https://github.com/moment/moment/issues/5926#issuecomment-1056785251","rel":["nofollow"]},"children":[{"type":"text","value":"issue"}]},{"type":"text","value":" Github, j'ai finalement réussi à réglé le problème et complété la migration vers Nuxt 3 de mon application."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Avec Vite.js, il faut simplement changer l'import des locales comme ceci:"}]},{"type":"element","tag":"code","props":{"code":"- import 'moment/locale/fr-ca';\n\n+ import 'moment/dist/locale/fr-ca';\n","language":"diff"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7acfc1"},"children":[{"type":"text","value":"- import 'moment/locale/fr-ca';"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-185ae9"},"children":[{"type":"text","value":"+ import 'moment/dist/locale/fr-ca';"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Malheureusement, ne vous attendez pas à une correction de la part de moment.js puisque le projet est en mode maintenance et ne recevera de mise à jour que si une faille de sécurité majeure est découverte."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vous pouvez migrer vers une alternatives plus modernes à moment.js, mais dans mon cas, je devais migré une code base utilisant largement moment.js en Nuxt 3."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"J'ai bien tenté de migrer vers "},{"type":"element","tag":"a","props":{"href":"https://day.js.org/","rel":["nofollow"]},"children":[{"type":"text","value":"Day.js"}]},{"type":"text","value":" a une API rétrocompatible et à l'avantage d'une approche modulaire et un code plus moderne lui permettant d'avoir un poid réduit (7kb vs 61kb) en prenant avantage des dernières fonctionnalités d'internationalisation d'EcmaScript, mais j'ai fait façe à une fonctionalité manquante en lien avec le parsing des heures (Ex. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"10:00:00"}]},{"type":"text","value":") sans date d'associées."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Heureusement, je pourrai peut-être faire la migration éventuellement puisqu'une "},{"type":"element","tag":"a","props":{"href":"https://github.com/iamkun/dayjs/pull/2197","rel":["nofollow"]},"children":[{"type":"text","value":"pull request"}]},{"type":"text","value":" afin d'apporter cette fonctionnalité à Day.js a été ouverte après que j'aie ouvert l'"},{"type":"element","tag":"a","props":{"href":"https://github.com/iamkun/dayjs/issues/2179","rel":["nofollow"]},"children":[{"type":"text","value":"issue"}]},{"type":"text","value":" sur Github afin de reportée ce manquemant par rapport à moment.js."}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-185ae9{color:#219186}\n.ct-7acfc1{color:#DC322F}\n.ct-ad8eda{color:#268BD2}\n.ct-083dc6{color:#073642}\n.ct-9ae664{color:#2AA198}\n.ct-82aea0{color:#268BD2}\n.ct-29651d{color:#657B83}\n.ct-9c4aea{color:#859900}\n.dark .ct-9c4aea{color:#859900}\n.dark .ct-29651d{color:#93A1A1}\n.dark .ct-82aea0{color:#268BD2}\n.dark .ct-9ae664{color:#2AA198}\n.dark .ct-083dc6{color:#93A1A1}\n.dark .ct-ad8eda{color:#CB4B16}\n.dark .ct-7acfc1{color:#DC322F}\n.dark .ct-185ae9{color:#219186}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:blog:2023-01-17-momentjs-avec-nuxt3.md","_source":"content","_file":"blog/2023-01-17-momentjs-avec-nuxt3.md","_extension":"md"}